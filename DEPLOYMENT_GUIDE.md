# ğŸ“± éƒ¨ç½²å’Œå®‰å…¨æŒ‡å—

## ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•ï¼ˆåœ¨åˆ†äº«ç»™ä»–äººä¹‹å‰å¿…åšï¼ï¼‰

### 1. æ›´æ–°æ•°æ®åº“å®‰å…¨ç­–ç•¥
**é‡è¦æ€§ï¼šâ­â­â­â­â­**

å½“å‰ä»£ç å…è®¸ç”¨æˆ·è‡ªå·±ç»™è‡ªå·±åŠ åˆ†ï¼Œä½†æ•°æ®åº“ RLS ç­–ç•¥å¯èƒ½ä¸æ”¯æŒï¼Œæˆ–è€…é…ç½®ä¸å½“ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚

**æ“ä½œæ­¥éª¤ï¼š**
1. æ‰“å¼€ Supabase Dashboard â†’ SQL Editor
2. å¤åˆ¶å¹¶è¿è¡Œ `SECURITY_UPDATE.sql` æ–‡ä»¶ä¸­çš„æ‰€æœ‰ SQL è¯­å¥
3. è¿™ä¼šï¼š
   - âœ… å…è®¸ç”¨æˆ·ç»™è‡ªå·±åŠ åˆ†ï¼ˆå•æ¬¡æœ€å¤š 100 åˆ†ï¼‰
   - âœ… é™åˆ¶æ¯å¤©æœ€å¤šè‡ªæˆ‘åŠ åˆ† 5 æ¬¡
   - âœ… ç®¡ç†å‘˜å¯ä»¥ç»™ä»»ä½•äººåŠ /æ‰£åˆ†
   - âœ… ç¡®ä¿æ‰€æœ‰ç”¨æˆ·å¯ä»¥çœ‹åˆ°å½¼æ­¤çš„åŸºæœ¬ä¿¡æ¯

### 2. éªŒè¯ Storage æƒé™ï¼ˆå¤´åƒä¸Šä¼ ï¼‰
**é‡è¦æ€§ï¼šâ­â­â­â­**

å¦‚æœå¼€å¯äº†å¤´åƒä¸Šä¼ åŠŸèƒ½ï¼Œéœ€è¦ç¡®ä¿ Storage çš„ RLS ç­–ç•¥æ­£ç¡®ã€‚

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. Supabase Dashboard â†’ Storage â†’ avatars bucket
2. æ£€æŸ¥ Policiesï¼š
   - ç”¨æˆ·å¯ä»¥ä¸Šä¼ /æ›´æ–°è‡ªå·±çš„å¤´åƒ
   - æ‰€æœ‰äººå¯ä»¥æŸ¥çœ‹å¤´åƒï¼ˆå…¬å¼€è¯»å–ï¼‰

**å‚è€ƒ SQLï¼š**
```sql
-- å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå·±çš„å¤´åƒ
create policy "Users can upload own avatar"
on storage.objects for insert
with check (
  bucket_id = 'avatars' 
  and auth.uid()::text = (storage.foldername(name))[1]
);

-- å…è®¸ç”¨æˆ·æ›´æ–°è‡ªå·±çš„å¤´åƒ
create policy "Users can update own avatar"
on storage.objects for update
using (
  bucket_id = 'avatars' 
  and auth.uid()::text = (storage.foldername(name))[1]
);

-- å…è®¸æ‰€æœ‰äººæŸ¥çœ‹å¤´åƒ
create policy "Public can view avatars"
on storage.objects for select
using (bucket_id = 'avatars');
```

### 3. å…³é—­é‚®ç®±éªŒè¯ï¼ˆå¯é€‰ï¼‰
**é‡è¦æ€§ï¼šâ­â­â­**

å¦‚æœä½ å¸Œæœ›ç”¨æˆ·æ³¨å†Œåç«‹å³ç™»å½•ï¼ˆä¸éœ€è¦ç‚¹å‡»é‚®ç®±éªŒè¯é“¾æ¥ï¼‰ï¼š

1. Supabase Dashboard â†’ Authentication â†’ Providers â†’ Email
2. æ‰¾åˆ° "Confirm email" é€‰é¡¹
3. å…³é—­å®ƒ

**æ³¨æ„ï¼š** å…³é—­åä»»ä½•äººéƒ½å¯ä»¥ç”¨ä»»æ„é‚®ç®±æ³¨å†Œï¼Œæ›´æ–¹ä¾¿ä½†å®‰å…¨æ€§ç¨ä½ã€‚

### 4. è®¾ç½®ç®¡ç†å‘˜è´¦å·
**é‡è¦æ€§ï¼šâ­â­â­â­â­**

ç¡®ä¿åªæœ‰ä½ ï¼ˆæˆ–ä¿¡ä»»çš„äººï¼‰æ˜¯ç®¡ç†å‘˜ï¼š

1. Supabase Dashboard â†’ Database â†’ Table Editor â†’ profiles
2. æ‰¾åˆ°ä½ çš„è´¦å·ï¼ˆé€šè¿‡ email è¯†åˆ«ï¼‰
3. å°† `is_admin` è®¾ä¸º `true`
4. **ç¡®è®¤å…¶ä»–ç”¨æˆ·çš„ `is_admin` éƒ½æ˜¯ `false`**

### 5. ä¿æŠ¤æ•æ„Ÿä¿¡æ¯
**é‡è¦æ€§ï¼šâ­â­â­â­â­**

- âœ… `lib/supabase.ts` ä¸­çš„ `SUPABASE_URL` å’Œ `SUPABASE_ANON_KEY` å¯ä»¥å…¬å¼€ï¼ˆè¿™æ˜¯å‰ç«¯å…¬å¼€å¯†é’¥ï¼‰
- âŒ **ç»å¯¹ä¸è¦**åˆ†äº« Supabase Dashboard çš„ç™»å½•å¯†ç 
- âŒ **ç»å¯¹ä¸è¦**åˆ†äº« `service_role` å¯†é’¥ï¼ˆåœ¨ Supabase è®¾ç½®ä¸­ï¼‰

---

## ğŸ“± åœ¨æ‰‹æœºä¸Šè¿è¡Œ

### æ–¹å¼ 1ï¼šå±€åŸŸç½‘å†…è¿è¡Œï¼ˆæ¨èæµ‹è¯•ç”¨ï¼‰

**å‰æï¼š** æ‰‹æœºå’Œç”µè„‘è¿æ¥åŒä¸€ä¸ª WiFi

**æ­¥éª¤ï¼š**

1. **åœ¨ç”µè„‘ä¸Šå¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š**
   ```bash
   cd /Users/nini/my-app/point-tracker
   npx expo start
   ```

2. **æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºï¼Œæ‰¾åˆ°å±€åŸŸç½‘åœ°å€ï¼š**
   ```
   Metro waiting on exp://192.168.1.100:8081
   ```
   ï¼ˆæ³¨æ„ï¼š`192.168.x.x` æ˜¯ä½ çš„ç”µè„‘åœ¨å±€åŸŸç½‘çš„ IPï¼‰

3. **åœ¨æ‰‹æœºä¸Šæ“ä½œï¼š**
   - **iOS**ï¼šä¸‹è½½ "Expo Go" app â†’ æ‰«æç»ˆç«¯æ˜¾ç¤ºçš„ QR ç 
   - **Android**ï¼šä¸‹è½½ "Expo Go" app â†’ æ‰«æç»ˆç«¯æ˜¾ç¤ºçš„ QR ç 

4. **å¦‚æœæ‰«ç ä¸æˆåŠŸï¼š**
   ```bash
   npx expo start --tunnel
   ```
   è¿™ä¼šåˆ›å»ºä¸€ä¸ªå…¬ç½‘éš§é“ï¼Œé€Ÿåº¦è¾ƒæ…¢ä½†æ›´ç¨³å®šã€‚

---

### æ–¹å¼ 2ï¼šé€šè¿‡ GitHub Pages éƒ¨ç½² Web ç‰ˆï¼ˆæ¨èæ­£å¼ä½¿ç”¨ï¼‰

**ä¼˜ç‚¹ï¼š** ç”Ÿæˆä¸€ä¸ªç½‘å€ï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼ˆæ‰‹æœº/ç”µè„‘éƒ½è¡Œï¼‰

**æ­¥éª¤ï¼š**

#### A. å¯¼å‡º Web ç‰ˆæœ¬
```bash
cd /Users/nini/my-app/point-tracker
npx expo export --platform web
```

è¿™ä¼šåœ¨ `dist/` æ–‡ä»¶å¤¹ç”Ÿæˆé™æ€ç½‘é¡µæ–‡ä»¶ã€‚

#### B. éƒ¨ç½²åˆ° GitHub Pages

1. **åˆå§‹åŒ– Git ä»“åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   ```

2. **åœ¨ GitHub åˆ›å»ºä»“åº“ï¼š**
   - è®¿é—® https://github.com/new
   - ä»“åº“åï¼š`point-tracker`ï¼ˆæˆ–ä»»æ„åç§°ï¼‰
   - è®¾ä¸º Public æˆ– Privateï¼ˆPrivate ä¹Ÿå¯ä»¥éƒ¨ç½²ï¼‰

3. **æ¨é€ä»£ç åˆ° GitHubï¼š**
   ```bash
   git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/point-tracker.git
   git branch -M main
   git push -u origin main
   ```

4. **éƒ¨ç½² Web ç‰ˆæœ¬ï¼š**
   ```bash
   # å®‰è£… gh-pages å·¥å…·
   npm install --save-dev gh-pages
   
   # éƒ¨ç½² dist æ–‡ä»¶å¤¹
   npx gh-pages -d dist
   ```

5. **åœ¨ GitHub å¯ç”¨ Pagesï¼š**
   - GitHub ä»“åº“é¡µé¢ â†’ Settings â†’ Pages
   - Source é€‰æ‹© `gh-pages` åˆ†æ”¯
   - ä¿å­˜åï¼Œä¼šæ˜¾ç¤ºç½‘å€ï¼š`https://ä½ çš„ç”¨æˆ·å.github.io/point-tracker/`

6. **åˆ†äº«ç½‘å€ï¼š**
   - æ‰‹æœºæµè§ˆå™¨æ‰“å¼€è¿™ä¸ªç½‘å€å³å¯ä½¿ç”¨
   - å¯ä»¥æ·»åŠ åˆ°æ‰‹æœºä¸»å±å¹•ï¼Œåƒ App ä¸€æ ·ä½¿ç”¨

---

### æ–¹å¼ 3ï¼šæ‰“åŒ…æˆçœŸæ­£çš„ Appï¼ˆé«˜çº§ï¼‰

å¦‚æœéœ€è¦å‘å¸ƒåˆ° App Store æˆ– Google Playï¼š

```bash
# iOS æ‰“åŒ…ï¼ˆéœ€è¦ Mac + Apple Developer è´¦å·ï¼‰
npx expo build:ios

# Android æ‰“åŒ…ï¼ˆç”Ÿæˆ APKï¼‰
npx expo build:android
```

**æ³¨æ„ï¼š** è¿™éœ€è¦é…ç½®æ›´å¤šä¸œè¥¿ï¼ˆè¯ä¹¦ã€ç­¾åç­‰ï¼‰ï¼Œå»ºè®®å…ˆç”¨ Web ç‰ˆæœ¬æµ‹è¯•ã€‚

---

## ğŸ§ª æµ‹è¯•æ¸…å•ï¼ˆåˆ†äº«å‰å¿…æµ‹ï¼‰

### æµ‹è¯•è´¦å·
1. âœ… æ³¨å†Œæ–°ç”¨æˆ·
2. âœ… ç™»å½•/ç™»å‡º
3. âœ… ä¸Šä¼ å¤´åƒå’Œæ˜µç§°

### æ™®é€šç”¨æˆ·åŠŸèƒ½
1. âœ… æŸ¥çœ‹è‡ªå·±çš„ç§¯åˆ†
2. âœ… ç‚¹å‡»"è‡ªæˆ‘åŠ åˆ†"æŒ‰é’®ï¼ˆæ¯å¤©æœ€å¤š5æ¬¡ï¼‰
3. âœ… å…‘æ¢å°å¥–åŠ±ï¼ˆè‡ªåŠ¨æ‰£åˆ†ï¼‰
4. âœ… ç”³è¯·å¤§å¥–åŠ±ï¼ˆéœ€è¦ç®¡ç†å‘˜æ‰¹å‡†ï¼‰
5. âœ… æŸ¥çœ‹ç§¯åˆ†å†å²
6. âœ… æŸ¥çœ‹å›¾è¡¨

### ç®¡ç†å‘˜åŠŸèƒ½
1. âœ… çœ‹åˆ°æ‰€æœ‰ç”¨æˆ·
2. âœ… ç»™ç”¨æˆ·åŠ /æ‰£åˆ†
3. âœ… ç®¡ç†åŠ åˆ†ä»»åŠ¡ï¼ˆé¦–é¡µç¼–è¾‘æ¨¡å¼ï¼‰
4. âœ… ç®¡ç†æ‰£åˆ†ä»»åŠ¡ï¼ˆç®¡ç†é¡µé¢ï¼‰
5. âœ… ç®¡ç†å¥–åŠ±ï¼ˆé¦–é¡µç¼–è¾‘æ¨¡å¼ï¼‰
6. âœ… æ‰¹å‡†å…‘æ¢ç”³è¯·ï¼ˆå¦‚æœæœ‰ï¼‰

### å®‰å…¨æµ‹è¯•
1. âœ… æ™®é€šç”¨æˆ·çœ‹ä¸åˆ°"ç®¡ç†é¡µé¢"å…¥å£
2. âœ… æ™®é€šç”¨æˆ·çœ‹ä¸åˆ°"ç¼–è¾‘æ¨¡å¼"å¼€å…³
3. âœ… æ™®é€šç”¨æˆ·ä¸èƒ½ç»™åˆ«äººåŠ /æ‰£åˆ†
4. âœ… è‡ªæˆ‘åŠ åˆ†æœ‰æ¯æ—¥é™åˆ¶ï¼ˆ5æ¬¡ï¼‰
5. âœ… å•æ¬¡è‡ªæˆ‘åŠ åˆ†ä¸èƒ½è¶…è¿‡100åˆ†

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ç”¨æˆ·æ³¨å†Œåçœ‹ä¸åˆ°è‡ªå·±çš„ä¿¡æ¯ï¼Ÿ
**A:** æ£€æŸ¥ Supabase çš„ `handle_new_user` è§¦å‘å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚åœ¨ SQL Editor è¿è¡Œï¼š
```sql
select * from profiles;
```
å¦‚æœæ²¡æœ‰æ–°ç”¨æˆ·æ•°æ®ï¼Œæ‰‹åŠ¨æ’å…¥ï¼š
```sql
insert into profiles (id, email, is_admin, points)
values ('ç”¨æˆ·çš„UUID', 'ç”¨æˆ·çš„é‚®ç®±', false, 0);
```

### Q2: ç”¨æˆ·æ— æ³•ç»™è‡ªå·±åŠ åˆ†ï¼Ÿ
**A:** RLS ç­–ç•¥é—®é¢˜ã€‚ç¡®ä¿è¿è¡Œäº† `SECURITY_UPDATE.sql` ä¸­çš„æ‰€æœ‰ SQLã€‚

### Q3: ç®¡ç†å‘˜çœ‹ä¸åˆ°å…¶ä»–ç”¨æˆ·ï¼Ÿ
**A:** è¿è¡Œï¼š
```sql
create policy "Enable read access for all users" 
  on profiles for select 
  using (true);
```

### Q4: æ‰‹æœºä¸Šæ˜¾ç¤º"Network request failed"ï¼Ÿ
**A:** æ£€æŸ¥ï¼š
1. æ‰‹æœºå’Œç”µè„‘æ˜¯å¦åœ¨åŒä¸€ WiFi
2. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†ç«¯å£ 8081
3. å°è¯• `npx expo start --tunnel`

---

## ğŸ“ å¦‚æœé‡åˆ°é—®é¢˜

1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰çš„é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ Expo ç»ˆç«¯çš„é”™è¯¯ä¿¡æ¯
3. æ£€æŸ¥ Supabase Dashboard â†’ Database â†’ Table Editor çš„æ•°æ®
4. æ£€æŸ¥ Supabase Dashboard â†’ Authentication çš„ç”¨æˆ·åˆ—è¡¨

ä¿ç•™æ‰€æœ‰é”™è¯¯æˆªå›¾ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚

